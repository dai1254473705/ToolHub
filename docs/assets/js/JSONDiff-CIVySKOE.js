import{i as e}from"./rolldown-runtime-tH7qxucP.js";import{O as s,R as l,T as r,W as i,n,p as t,r as o,x as a}from"./antd-_Zl8gVdI.js";import{E as c,T as f}from"./react-BimuKvkN.js";import{o as d,w as m,x as u}from"./vendor-ClqHxgW3.js";var j=e(i()),x=e(f()),{Title:h}=o,p=()=>{const{t:e}=c(),[i,o]=(0,j.useState)(""),[f,p]=(0,j.useState)(""),[N,g]=(0,j.useState)([]),[v,D]=(0,j.useState)([]),[y,b]=(0,j.useState)(null),[S,C]=(0,j.useState)(null),[k,R]=(0,j.useState)(!1),O=(0,j.useRef)(null),w=(0,j.useRef)(null),E=(0,j.useRef)(null),J=(0,j.useRef)(null),T=e=>{if(!e.trim())return{isValid:!1,formatted:""};try{const s=JSON.parse(e);return{isValid:!0,formatted:JSON.stringify(s,null,2)}}catch{return{isValid:!1,formatted:""}}};(0,j.useEffect)(()=>{if(!i.trim())return b(null),void R(!1);const e=T(i);b(e.isValid),R(!1)},[i]),(0,j.useEffect)(()=>{if(!f.trim())return C(null),void R(!1);const e=T(f);C(e.isValid),R(!1)},[f]);const V=(e,s)=>{if(!e)return;const l=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},L=(e,s)=>{const l=e.target.files?.[0];if(!l)return;const r=new FileReader;r.onload=e=>{const l=e.target?.result;s(l)},r.readAsText(l),e.target&&(e.target.value="")},U=e=>{e.current&&e.current.click()};return(0,x.jsxs)("div",{className:"json-diff-container",children:[(0,x.jsx)(h,{level:4,children:e("tools.jsonDiff.title")}),(0,x.jsx)("div",{className:"json-diff-controls",children:(0,x.jsx)(l,{type:"primary",icon:(0,x.jsx)(u,{}),onClick:()=>{if(i.trim()&&f.trim())if(!0===y&&!0===S)try{const s=JSON.parse(i),l=JSON.parse(f),r=JSON.stringify(s,null,2),n=JSON.stringify(l,null,2),o=r.split("\n"),a=n.split("\n"),c=o.map((e,s)=>({line:e,isDifferent:a[s]!==e,lineNumber:s+1})),d=a.map((e,s)=>({line:e,isDifferent:o[s]!==e,lineNumber:s+1}));g(c),D(d),R(!0),t.success(e("tools.jsonDiff.messages.compareSuccess"))}catch(s){t.error(e("tools.jsonDiff.messages.compareError",{error:s instanceof Error?s.message:"未知错误"}))}else t.error(e("tools.jsonDiff.messages.invalidFormat"));else t.warning(e("tools.jsonDiff.messages.inputBoth"))},disabled:!0!==y||!0!==S,children:e("tools.jsonDiff.controls.compare")})}),(0,x.jsxs)("div",{className:"json-diff-grid",children:[(0,x.jsxs)(s,{title:e("tools.jsonDiff.left.title"),extra:(0,x.jsxs)(a,{children:[(0,x.jsx)(l,{icon:(0,x.jsx)(m,{}),onClick:()=>{o(""),b(null),R(!1),O.current&&O.current.focus()},children:e("common.clear")}),(0,x.jsx)(l,{icon:(0,x.jsx)(d,{}),onClick:()=>U(E),children:e("common.upload")}),(0,x.jsx)(l,{icon:(0,x.jsx)(n,{}),onClick:()=>V(i,"left.json"),disabled:!i,children:e("common.download")}),(0,x.jsx)("input",{ref:E,type:"file",accept:".json",style:{display:"none"},onChange:e=>L(e,o)})]}),className:!1===y?"error-card":"",children:[(0,x.jsx)("textarea",{ref:O,value:i,onChange:e=>o(e.target.value),placeholder:e("tools.jsonDiff.left.placeholder"),className:"json-input"}),!1===y&&(0,x.jsx)("div",{className:"error-message",children:e("tools.jsonDiff.messages.formatError")})]}),(0,x.jsx)(r,{type:"vertical",className:"divider"}),(0,x.jsxs)(s,{title:e("tools.jsonDiff.right.title"),extra:(0,x.jsxs)(a,{children:[(0,x.jsx)(l,{icon:(0,x.jsx)(m,{}),onClick:()=>{p(""),C(null),R(!1),w.current&&w.current.focus()},children:e("common.clear")}),(0,x.jsx)(l,{icon:(0,x.jsx)(d,{}),onClick:()=>U(J),children:e("common.upload")}),(0,x.jsx)(l,{icon:(0,x.jsx)(n,{}),onClick:()=>V(f,"right.json"),disabled:!f,children:e("common.download")}),(0,x.jsx)("input",{ref:J,type:"file",accept:".json",style:{display:"none"},onChange:e=>L(e,p)})]}),className:!1===S?"error-card":"",children:[(0,x.jsx)("textarea",{ref:w,value:f,onChange:e=>p(e.target.value),placeholder:e("tools.jsonDiff.right.placeholder"),className:"json-input"}),!1===S&&(0,x.jsx)("div",{className:"error-message",children:e("tools.jsonDiff.messages.formatError")})]})]}),k&&(0,x.jsxs)("div",{className:"json-diff-results",children:[(0,x.jsx)(h,{level:5,children:e("tools.jsonDiff.results.title")}),(0,x.jsxs)("div",{className:"json-diff-results-grid",children:[(0,x.jsx)(s,{title:e("tools.jsonDiff.results.leftTitle"),className:"diff-result-card",children:(0,x.jsx)("div",{className:"diff-result-content",children:N.map((e,s)=>(0,x.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,x.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,x.jsx)("span",{className:"line-content",children:e.line})]},s))})}),(0,x.jsx)(r,{type:"vertical",className:"divider"}),(0,x.jsx)(s,{title:e("tools.jsonDiff.results.rightTitle"),className:"diff-result-card",children:(0,x.jsx)("div",{className:"diff-result-content",children:v.map((e,s)=>(0,x.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,x.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,x.jsx)("span",{className:"line-content",children:e.line})]},s))})})]})]})]})};export{p as default};