import{i as e}from"./rolldown-runtime-tH7qxucP.js";import{G as s,L as t,N as l,O as n,P as i,T as r,f as a,n as o,p as c,r as d,x as f,z as u}from"./antd-DHjKV_bb.js";import{E as m,T as j}from"./react-DF9HAzp0.js";import{C as h,D as x,E as p,M as g,T as y,b as N,o as v,x as S}from"./vendor-C33QSf7L.js";var D=e(s()),b=e(j()),{Title:w}=d,C=()=>{const{t:e}=m(),[s,d]=(0,D.useState)(""),[j,C]=(0,D.useState)(""),[$,k]=(0,D.useState)([]),[E,O]=(0,D.useState)([]),[A,R]=(0,D.useState)(null),[T,z]=(0,D.useState)(null),[J,L]=(0,D.useState)(!1),[V,I]=(0,D.useState)(!1),[U,B]=(0,D.useState)(!1),[F,M]=(0,D.useState)(!1),G=(0,D.useRef)(null),P=(0,D.useRef)(null),q=(0,D.useRef)(null),H=(0,D.useRef)(null),K=e=>{if(!e.trim())return{isValid:!1,formatted:""};try{const s=JSON.parse(e);return{isValid:!0,formatted:JSON.stringify(s,null,2)}}catch{return{isValid:!1,formatted:""}}};(0,D.useEffect)(()=>{if(!s.trim())return R(null),void L(!1);const e=K(s);R(e.isValid),L(!1)},[s]),(0,D.useEffect)(()=>{if(!j.trim())return z(null),void L(!1);const e=K(j);z(e.isValid),L(!1)},[j]);const Q=(e,s,t="",l=new Set)=>{if(null===e||null===s)return e!==s&&l.add(t),l;if(typeof e!=typeof s)return l.add(t),l;if("object"!=typeof e)return e!==s&&l.add(t),l;if(Array.isArray(e)&&Array.isArray(s)){e.length!==s.length&&l.add(t);const n=Math.max(e.length,s.length);for(let i=0;i<n;i++)Q(e[i],s[i],`${t}[${i}]`,l);return l}if(!Array.isArray(e)&&!Array.isArray(s)){const n=new Set(Object.keys(e).sort()),i=new Set(Object.keys(s).sort());for(const e of n)i.has(e)||l.add(`${t}.${e}`);for(const e of i)n.has(e)||l.add(`${t}.${e}`);for(const r of n)i.has(r)&&Q(e[r],s[r],t?`${t}.${r}`:r,l);return l}return l.add(t),l},W=(e,s)=>{const t=JSON.stringify(e,null,2).split("\n"),l=[],n=new Array(t.length).fill(null);return(()=>{const e=[];t.forEach((s,t)=>{const l=s.trim(),i=s.search(/\S/);for(;e.length>0&&e[e.length-1].indent>=i;)e.pop();let r=e.length>0?e[e.length-1].path:"";const a=l.match(/^"([^"]+)"\s*:\s*(.+)$/);if(a){const s=a[1],l=a[2].trim();r=r?`${r}.${s}`:s,"{"!==l&&"["!==l&&(n[t]=r),e.push({path:r,indent:i})}else if("{"===l||"}"===l);else if("["===l||"]"===l);else if(l.match(/^"([^"]+)"\s*:\s*[\[\{]$/)){const s=l.match(/^"([^"]+)"\s*:/)[1];r=r?`${r}.${s}`:s,e.push({path:r,indent:i}),n[t]=r}})})(),t.forEach((e,t)=>{const i=t+1,r=n[t];let a=!1,o="";r&&s.has(r)&&(a=!0,o=r),l.push({line:e,isDifferent:a,lineNumber:i,path:a?o:void 0})}),l},X=(e,s)=>{if(!e)return;const t=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)},Y=(e,s)=>{const t=e.target.files?.[0];if(!t)return;const l=new FileReader;l.onload=e=>{const t=e.target?.result;s(t)},l.readAsText(t),e.target&&(e.target.value="")},Z=e=>{e.current&&e.current.click()},_=(()=>{if(!J)return 0;const e=new Set($.filter(e=>e.isDifferent).map(e=>e.path)),s=new Set(E.filter(e=>e.isDifferent).map(e=>e.path));return new Set([...e,...s]).size})(),ee=_>0;return(0,b.jsxs)("div",{className:"json-diff-container",children:[(0,b.jsx)(w,{level:4,children:e("tools.jsonDiff.title")}),(0,b.jsx)("div",{className:"json-diff-controls",children:(0,b.jsx)(u,{type:"primary",icon:(0,b.jsx)(h,{}),onClick:()=>{if(s.trim()&&j.trim())if(!0===A&&!0===T)try{const t=JSON.parse(s),l=JSON.parse(j),n=Q(t,l),i=W(t,n),r=W(l,n);k(i),O(r),L(!0),B(!0),c.success(e("tools.jsonDiff.messages.compareSuccess"))}catch(t){c.error(e("tools.jsonDiff.messages.compareError",{error:t instanceof Error?t.message:"未知错误"}))}else c.error(e("tools.jsonDiff.messages.invalidFormat"));else c.warning(e("tools.jsonDiff.messages.inputBoth"))},disabled:!0!==A||!0!==T,children:e("tools.jsonDiff.controls.compare")})}),(0,b.jsxs)("div",{className:"json-diff-grid "+(U?"collapsed":""),children:[(0,b.jsxs)(n,{title:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,b.jsx)(u,{type:"text",size:"small",icon:U?(0,b.jsx)(t,{}):(0,b.jsx)(g,{}),onClick:()=>B(!U),style:{padding:0,width:24,height:24}}),e("tools.jsonDiff.left.title")]}),extra:(0,b.jsxs)(f,{children:[(0,b.jsx)(u,{icon:(0,b.jsx)(p,{}),onClick:()=>{d(""),R(null),L(!1),G.current&&G.current.focus()},children:e("common.clear")}),(0,b.jsx)(u,{icon:(0,b.jsx)(v,{}),onClick:()=>Z(q),children:e("common.upload")}),(0,b.jsx)(u,{icon:(0,b.jsx)(o,{}),onClick:()=>X(s,"left.json"),disabled:!s,children:e("common.download")}),(0,b.jsx)("input",{ref:q,type:"file",accept:".json",style:{display:"none"},onChange:e=>Y(e,d)})]}),className:`${!1===A?"error-card":""} ${U?"collapsed-card":""}`,children:[(0,b.jsx)("textarea",{ref:G,value:s,onChange:e=>d(e.target.value),placeholder:e("tools.jsonDiff.left.placeholder"),className:"json-input"}),!1===A&&(0,b.jsx)("div",{className:"error-message",children:e("tools.jsonDiff.messages.formatError")})]}),(0,b.jsx)(r,{type:"vertical",className:"divider"}),(0,b.jsxs)(n,{title:e("tools.jsonDiff.right.title"),extra:(0,b.jsxs)(f,{children:[(0,b.jsx)(u,{icon:(0,b.jsx)(p,{}),onClick:()=>{C(""),z(null),L(!1),P.current&&P.current.focus()},children:e("common.clear")}),(0,b.jsx)(u,{icon:(0,b.jsx)(v,{}),onClick:()=>Z(H),children:e("common.upload")}),(0,b.jsx)(u,{icon:(0,b.jsx)(o,{}),onClick:()=>X(j,"right.json"),disabled:!j,children:e("common.download")}),(0,b.jsx)("input",{ref:H,type:"file",accept:".json",style:{display:"none"},onChange:e=>Y(e,C)})]}),className:`${!1===T?"error-card":""} ${U?"collapsed-card":""}`,children:[(0,b.jsx)("textarea",{ref:P,value:j,onChange:e=>C(e.target.value),placeholder:e("tools.jsonDiff.right.placeholder"),className:"json-input"}),!1===T&&(0,b.jsx)("div",{className:"error-message",children:e("tools.jsonDiff.messages.formatError")})]})]}),J&&(0,b.jsxs)("div",{className:"json-diff-results "+(F?"collapsed":""),children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,b.jsx)(u,{type:"text",size:"small",icon:F?(0,b.jsx)(t,{}):(0,b.jsx)(g,{}),onClick:()=>M(!F),style:{padding:0,width:24,height:24}}),(0,b.jsx)(w,{level:5,style:{margin:0},children:e("tools.jsonDiff.results.title")}),ee?(0,b.jsx)(l,{count:_,title:`${_} 个字段不一致`,children:(0,b.jsx)(i,{title:`${_} 个字段不一致`,children:(0,b.jsx)(y,{style:{color:"#ff4d4f",fontSize:16}})})}):(0,b.jsx)(i,{title:"完全一致",children:(0,b.jsx)(x,{style:{color:"#52c41a",fontSize:16}})})]}),(0,b.jsx)(u,{icon:(0,b.jsx)(N,{}),onClick:()=>I(!0),children:"全屏查看"})]}),(0,b.jsxs)("div",{className:"json-diff-results-grid "+(F?"collapsed":""),children:[(0,b.jsx)(n,{title:e("tools.jsonDiff.results.leftTitle"),className:"diff-result-card",children:(0,b.jsx)("div",{className:"diff-result-content",children:$.map((e,s)=>(0,b.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,b.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,b.jsx)("span",{className:"line-content",children:e.line})]},s))})}),(0,b.jsx)(r,{type:"vertical",className:"divider"}),(0,b.jsx)(n,{title:e("tools.jsonDiff.results.rightTitle"),className:"diff-result-card",children:(0,b.jsx)("div",{className:"diff-result-content",children:E.map((e,s)=>(0,b.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,b.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,b.jsx)("span",{className:"line-content",children:e.line})]},s))})})]})]}),(0,b.jsx)(a,{title:(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("span",{children:"JSON 对比结果 - 全屏查看"}),(0,b.jsx)(u,{type:"text",icon:(0,b.jsx)(S,{}),onClick:()=>I(!1),children:"退出全屏"})]}),open:V,onCancel:()=>I(!1),footer:null,width:"95vw",style:{top:20},bodyStyle:{height:"calc(100vh - 150px)",overflow:"auto"},children:(0,b.jsxs)("div",{className:"json-diff-results-grid json-diff-results-grid-fullscreen",children:[(0,b.jsx)(n,{title:e("tools.jsonDiff.results.leftTitle"),className:"diff-result-card diff-result-card-fullscreen",children:(0,b.jsx)("div",{className:"diff-result-content diff-result-content-fullscreen",children:$.map((e,s)=>(0,b.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,b.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,b.jsx)("span",{className:"line-content",children:e.line})]},s))})}),(0,b.jsx)(r,{type:"vertical",className:"divider divider-fullscreen"}),(0,b.jsx)(n,{title:e("tools.jsonDiff.results.rightTitle"),className:"diff-result-card diff-result-card-fullscreen",children:(0,b.jsx)("div",{className:"diff-result-content diff-result-content-fullscreen",children:E.map((e,s)=>(0,b.jsxs)("div",{className:"diff-line "+(e.isDifferent?"diff-different":"diff-same"),children:[(0,b.jsx)("span",{className:"line-number",children:e.lineNumber}),(0,b.jsx)("span",{className:"line-content",children:e.line})]},s))})})]})})]})};export{C as default};